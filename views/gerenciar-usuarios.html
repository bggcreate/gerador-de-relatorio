<div class="container-fluid" style="max-width: 1200px;">
    <h4 class="mb-3">Configurações</h4>

    <!-- Abas de Navegação -->
    <ul class="nav nav-tabs mb-4" id="configTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="usuarios-tab" data-bs-toggle="tab" data-bs-target="#usuarios" type="button" role="tab" aria-controls="usuarios" aria-selected="true">
                <i class="bi bi-people-fill me-2"></i>Usuários
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="backup-tab" data-bs-toggle="tab" data-bs-target="#backup" type="button" role="tab" aria-controls="backup" aria-selected="false">
                <i class="bi bi-database-fill-gear me-2"></i>Backup e Restauração
            </button>
        </li>
    </ul>

    <!-- Conteúdo das Abas -->
    <div class="tab-content" id="configTabContent">
        <!-- Aba de Usuários -->
        <div class="tab-pane fade show active" id="usuarios" role="tabpanel" aria-labelledby="usuarios-tab">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Gerenciamento de Usuários</span>
                    <button id="btn-adicionar-usuario" class="btn btn-primary"><i class="bi bi-plus-lg me-2"></i>Adicionar Usuário</button>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-borderless mb-0">
                            <thead>
                                <tr>
                                    <th class="ps-3">ID</th>
                                    <th>Usuário</th>
                                    <th>Cargo</th>
                                    <th>Lojas Vinculadas</th>
                                    <th class="text-end pe-3">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-usuarios-corpo">
                                <!-- Conteúdo inserido via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Aba de Backup -->
        <div class="tab-pane fade" id="backup" role="tabpanel" aria-labelledby="backup-tab">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Informações e Ações</div>
                        <div class="card-body">
                            <p class="mb-2"><strong>Tamanho do Banco de Dados:</strong> <span id="db-size">Carregando...</span></p>
                            <small class="d-block mb-3 text-muted">Este é o tamanho atual do seu arquivo de banco de dados principal.</small>
                            <div class="d-grid gap-2">
                                <a href="/api/backup/download" class="btn btn-success"><i class="bi bi-download me-2"></i>Baixar Backup do Banco de Dados</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-danger">
                        <div class="card-header bg-danger bg-opacity-10 text-danger-emphasis">Área de Risco</div>
                        <div class="card-body">
                            <h6 class="text-danger-emphasis">Restaurar Backup</h6>
                            <p class="small text-muted">Substitua o banco de dados atual por um arquivo de backup (`.db`). **A ação é irreversível e o banco de dados atual será perdido.**</p>
                            <div class="input-group mb-3">
                                <input class="form-control" type="file" id="backup-file-input" accept=".db">
                                <button class="btn btn-danger" type="button" id="btn-restaurar-backup" disabled><i class="bi bi-upload me-2"></i>Restaurar</button>
                            </div>
                            <hr>
                            <h6 class="text-danger-emphasis">Limpar Banco de Dados</h6>
                            <p class="small text-muted">Exclui todos os relatórios e demandas. Lojas e usuários **não** são afetados. **Esta ação não pode ser desfeita.**</p>
                            <div class="d-grid">
                                <button class="btn btn-outline-danger" id="btn-limpar-db"><i class="bi bi-trash3-fill me-2"></i>Limpar Relatórios e Demandas</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Usuário (já existente, não precisa mudar) -->
<div class="modal fade" id="modal-usuario" tabindex="-1" aria-labelledby="modalUsuarioLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="form-usuario">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalUsuarioLabel">Adicionar Usuário</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="usuario-id" name="id">
                    <div class="mb-3">
                        <label for="usuario-username" class="form-label">Nome de Usuário</label>
                        <input type="text" class="form-control" id="usuario-username" required>
                    </div>
                    <div class="mb-3">
                        <label for="usuario-password" class="form-label" id="usuario-password-label">Senha</label>
                        <input type="password" class="form-control" id="usuario-password">
                    </div>
                    <div class="mb-3">
                        <label for="usuario-role" class="form-label">Cargo</label>
                        <select id="usuario-role" class="form-select" required>
                            <option value="gerente">Gerente</option>
                            <option value="consultor">Consultor</option>
                            <option value="monitoramento">Monitoramento</option>
                            <option value="tecnico">Técnico</option>
                            <option value="admin">Administrador</option>
                            <option value="dev">Desenvolvedor</option>
                        </select>
                    </div>
                    
                    <!-- Campo para Gerente - selecionar uma loja -->
                    <div class="mb-3" id="campo-loja-gerente" style="display:none;">
                        <label for="usuario-loja-gerente" class="form-label">Loja do Gerente</label>
                        <select id="usuario-loja-gerente" class="form-select">
                            <option value="">Selecione uma loja</option>
                        </select>
                        <small class="text-muted">Gerente tem acesso apenas a esta loja</small>
                    </div>
                    
                    <!-- Campo para Consultor - selecionar múltiplas lojas -->
                    <div class="mb-3" id="campo-lojas-consultor" style="display:none;">
                        <label for="usuario-lojas-consultor" class="form-label">Lojas do Consultor</label>
                        <select id="usuario-lojas-consultor" class="form-select" multiple size="5">
                        </select>
                        <small class="text-muted">Consultor tem acesso a múltiplas lojas (Ctrl+clique para selecionar várias)</small>
                    </div>
                    
                    <!-- Campo para Técnico - selecionar uma loja -->
                    <div class="mb-3" id="campo-loja-tecnico" style="display:none;">
                        <label for="usuario-loja-tecnico" class="form-label">Loja do Técnico</label>
                        <select id="usuario-loja-tecnico" class="form-select">
                            <option value="">Selecione uma loja</option>
                        </select>
                        <small class="text-muted">Técnico tem acesso apenas a esta loja e ao módulo de Assistência</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>